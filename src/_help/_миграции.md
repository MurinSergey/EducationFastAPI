1. Устанавливаем библиотеку alembic
    uv add alembic

2. Находясь в корне проекта, инициализируем миграции
    alembic init src/migrations

3. В файле alembic.ini изменяем строку:
    prepend_sys_path = . на prepend_sys_path = . src
    Таким образом добавляя область src в поле видимости проекта миграций

4. В файле src/migrations/env.py:
    Задаем ссылку на базовый класс модели Base
    target_metadata = Base.metadata

    Задаем драйвер подключения к БД, добавляя синтаксис, который выполнить асинхронный движок БД в синхронном режиме
    config.set_main_option("sqlalchemy.url", f"{settings.DATABASE_URL}?async_fallback=True")

5. Запускаем миграцию командой:
    alembic revision --autogenerate -m "initial migration"
В данном случае, команда создаст новую миграцию с сообщением "initial migration". Автоматическая генерация миграции означает, что Alembic будет анализировать текущую структуру базы данных и сравнивать ее с моделью данных, определенной в приложении. Если есть какие-либо изменения, Alembic сгенерирует соответствующий код миграции для применения этих изменений к базе данных.
Таким образом, эта команда помогает автоматизировать процесс создания миграций, что упрощает управление изменениями в структуре базы данных.
Флаг -m в команде alembic revision --autogenerate -m "initial migration" используется для добавления сообщения к миграции.
В данном случае, "initial migration" - это сообщение, которое будет связано с создаваемой миграцией. Это сообщение помогает понять, что именно было изменено в этой миграции.
Таким образом, флаг -m позволяет добавить описание к миграции, что упрощает понимание и отслеживание изменений в базе данных.

6. Для накатывания миграции набрать команду:
    Через номер ревизии
    alembic upgrade b4b829ac262e
    
    или до самой последней весрии 
    alembic upgrade head

7. Для отката миграции
    Через номер ревизии:
    alembic downgrade b4b829ac262e

    или на одну ревизию назад
    alembic downgrade -1

8. Для того чтобы новые файлы версии миграции были отформатированы и их название содержало дату создания миграции необходимо:
    в фале alembic.ini раскомментировать строчки:
        hooks = black
        black.type = console_scripts
        black.entrypoint = black
        black.options = -l 79 REVISION_SCRIPT_FILENAME
    где в последней строке поменять 79 на 88 (или любое другое число), чтобы задать количество символов строке.
    При это не забудь поставить библиотеку black

    А для задания названия файлов не забудь строку
    file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s
    